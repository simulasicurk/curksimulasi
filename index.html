<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simulasi Pinjaman Credit Union Remaung Kecubung</title>
<style>
  body {
    font-family: 'Poppins', sans-serif;
    background-color: #f0f8ff;
    margin: 0;
    padding: 0;
    color: #333;
  }
  header {
    background-color: #001f3f;
    color: white;
    text-align: center;
    padding: 15px;
  }
  header h1 { margin: 0; }
  .credit { color: #fa0202; font-style: italic; }
  .remaung { color: #0f02fa; font-weight: bold; }
  .container {
    max-width: 800px;
    margin: 20px auto;
    background: white;
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  }
  input {
    width: 100%;
    padding: 10px;
    margin: 6px 0;
    border: 1px solid #ccc;
    border-radius: 10px;
  }
  button {
    background-color: #0f02fa;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 10px;
    cursor: pointer;
  }
  button:hover { opacity: 0.9; }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
  }
  th, td {
    border: 1px solid #ccc;
    padding: 8px;
    text-align: right;
  }
  th {
    background-color: #0f02fa;
    color: white;
  }
  .export-buttons {
    margin-top: 20px;
    text-align: right;
  }
  .export-buttons button {
    background-color: #fa0202;
    margin-left: 10px;
  }

  /* Total section */
  .totals {
    display: flex;
    justify-content: space-between;
    margin-top: 15px;
    border-top: 2px solid #ccc;
    padding-top: 10px;
    text-align: center;
    font-weight: bold;
    color: #0f02fa;
    flex-wrap: wrap;
  }
  .total-box {
    flex: 1 1 30%;
    margin: 5px;
    background: #f8faff;
    border-radius: 8px;
    padding: 10px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  }
  .total-box span {
    display: block;
  }
  @media (max-width: 600px) {
    .totals { flex-direction: column; align-items: center; }
    .total-box { width: 90%; }
  }
</style>
</head>
<body>

<header>
  <h1><span class="credit">Credit Union</span> <span class="remaung">Remaung Kecubung</span></h1>
  <h3>Simulasi Pinjaman</h3>
</header>

<div class="container">
  <label>Pokok Pinjaman (Rp):</label>
  <input type="number" id="amount" placeholder="Masukkan jumlah pinjaman">
  <label>Suku Bunga per Bulan (%):</label>
  <input type="number" id="rate" placeholder="Masukkan bunga per bulan">
  <label>Tenor (bulan):</label>
  <input type="number" id="tenor" placeholder="Masukkan tenor dalam bulan">
  
  <button onclick="calculateInstallment()">Hitung</button>
  <button onclick="resetForm()" style="background-color:#fa0202;">Reset</button>

  <div id="result"></div>
  <div class="export-buttons">
    <button onclick="exportCSV()">Download CSV</button>
    <button onclick="exportPDF()">Download PDF</button>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>

<script>
function round50(x) {
  return Math.ceil(x / 50) * 50;
}

function calculateInstallment() {
  const amount = parseFloat(document.getElementById("amount").value);
  const rate = parseFloat(document.getElementById("rate").value) / 100;
  const tenor = parseInt(document.getElementById("tenor").value);
  if (!amount || !rate || !tenor) {
    alert("Mohon isi semua kolom input.");
    return;
  }

  const monthlyPayment = round50(amount * (rate * Math.pow(1 + rate, tenor)) / (Math.pow(1 + rate, tenor) - 1));
  let balance = amount;
  const today = new Date();

  let totalPokok = 0;
  let totalBunga = 0;
  let totalAngsuran = 0;

  let table = `
  <table id="tabelAngsuran">
    <thead>
      <tr>
        <th>Bulan</th>
        <th>Tanggal</th>
        <th>Angsuran</th>
        <th>Bunga</th>
        <th>Pokok</th>
        <th>Sisa Saldo</th>
      </tr>
    </thead>
    <tbody>`;

  for (let i = 1; i <= tenor; i++) {
    let bunga, pokok, tanggal;
    tanggal = new Date(today.getFullYear(), today.getMonth() + i, today.getDate()).toLocaleDateString('id-ID');

    if (i < tenor) {
      bunga = round50(balance * rate);
      pokok = round50(monthlyPayment - bunga);
      balance -= pokok;
    } else {
      pokok = round50(balance);
      bunga = round50(monthlyPayment - pokok);
      balance = 0;
    }

    totalPokok += pokok;
    totalBunga += bunga;
    totalAngsuran += monthlyPayment;

    table += `
      <tr>
        <td>${i}</td>
        <td style="text-align:center">${tanggal}</td>
        <td>${monthlyPayment.toLocaleString('id-ID')}</td>
        <td>${bunga.toLocaleString('id-ID')}</td>
        <td>${pokok.toLocaleString('id-ID')}</td>
        <td>${balance.toLocaleString('id-ID')}</td>
      </tr>`;
  }

  table += `</tbody></table>`;

  const totalHTML = `
    <div class="totals">
      <div class="total-box"><span>Total Angsuran</span><span>Rp ${totalAngsuran.toLocaleString('id-ID')}</span></div>
      <div class="total-box"><span>Total Pokok</span><span>Rp ${totalPokok.toLocaleString('id-ID')}</span></div>
      <div class="total-box"><span>Total Bunga</span><span>Rp ${totalBunga.toLocaleString('id-ID')}</span></div>
    </div>
  `;

  document.getElementById("result").innerHTML = table + totalHTML;
}

function resetForm() {
  document.getElementById("amount").value = '';
  document.getElementById("rate").value = '';
  document.getElementById("tenor").value = '';
  document.getElementById("result").innerHTML = '';
}

function exportCSV() {
  const rows = document.querySelectorAll("#tabelAngsuran tr");
  if (!rows.length) {
    alert("Tidak ada data untuk diunduh.");
    return;
  }
  let csv = [];
  for (let row of rows) {
    const cols = row.querySelectorAll("td, th");
    let data = Array.from(cols).map(c => c.innerText);
    csv.push(data.join(","));
  }

  const totalRow = ["", "", "TOTAL", 
    document.querySelector('.total-box:nth-child(3) span:last-child').innerText, 
    document.querySelector('.total-box:nth-child(2) span:last-child').innerText,
    document.querySelector('.total-box:nth-child(1) span:last-child').innerText
  ];
  csv.push(totalRow.join(","));

  const blob = new Blob([csv.join("\n")], { type: "text/csv" });
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "simulasi_angsuran.csv";
  link.click();
}

function exportPDF() {
  const rows = document.querySelectorAll("#tabelAngsuran tr");
  if (!rows.length) {
    alert("Tidak ada data untuk diunduh.");
    return;
  }
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ orientation: 'landscape' });
  doc.setFontSize(14);
  doc.text("Simulasi Pinjaman", 14, 15);
  doc.setFont("italic");
  doc.setTextColor(250, 2, 2);
  doc.text("Credit Union", 14, 22);
  doc.setFont("bold");
  doc.setTextColor(15, 2, 250);
  doc.text("Remaung Kecubung", 45, 22);

  doc.autoTable({
    html: "#tabelAngsuran",
    startY: 28,
    styles: { halign: 'right' },
    headStyles: { fillColor: [15, 2, 250], textColor: 255 }
  });

  const totalAng = document.querySelector('.total-box:nth-child(1) span:last-child').innerText;
  const totalPok = document.querySelector('.total-box:nth-child(2) span:last-child').innerText;
  const totalBun = document.querySelector('.total-box:nth-child(3) span:last-child').innerText;

  doc.autoTable({
    body: [
      ["Total Angsuran", totalAng],
      ["Total Pokok", totalPok],
      ["Total Bunga", totalBun]
    ],
    startY: doc.lastAutoTable.finalY + 10,
    theme: 'plain',
    styles: { fontStyle: 'bold', textColor: [15, 2, 250] },
    columnStyles: { 0: { halign: 'left' }, 1: { halign: 'right' } }
  });

  doc.save("simulasi_angsuran.pdf");
}
</script>
</body>
</html>
